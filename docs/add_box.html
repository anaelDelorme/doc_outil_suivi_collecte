<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.28">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Outil de suivi de collecte MASA - 6&nbsp; Ajout de box dans une page</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./add_shinymanager.html" rel="next">
<link href="./squellete_appli.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ajout de box dans une page</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Outil de suivi de collecte MASA</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/anaelDelorme/doc_outil_suivi_collecte" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="./outil_suivi_collecte_masa.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Préface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prerequis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Prérequis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./donnees.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Données</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dev_app_shiny.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Développement application shiny</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./squellete_appli.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Squelette de l’application Shiny</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./add_box.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ajout de box dans une page</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./add_shinymanager.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">add_shinymanager.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docker.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">docker.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./deploy.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">deploy.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./debug.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Débugage de l’application</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#accès-aux-données" id="toc-accès-aux-données" class="nav-link active" data-scroll-target="#accès-aux-données"> <span class="header-section-number">6.1</span> Accès aux données</a>
  <ul class="collapse">
  <li><a href="#le-plus-simple-chargement-à-chaque-module" id="toc-le-plus-simple-chargement-à-chaque-module" class="nav-link" data-scroll-target="#le-plus-simple-chargement-à-chaque-module"> <span class="header-section-number">6.1.1</span> Le plus simple : chargement à chaque module</a></li>
  <li><a href="#mieux-charger-les-données-une-seule-fois" id="toc-mieux-charger-les-données-une-seule-fois" class="nav-link" data-scroll-target="#mieux-charger-les-données-une-seule-fois"> <span class="header-section-number">6.1.2</span> Mieux : charger les données une seule fois</a></li>
  </ul></li>
  <li><a href="#ajouter-des-lignes" id="toc-ajouter-des-lignes" class="nav-link" data-scroll-target="#ajouter-des-lignes"> <span class="header-section-number">6.2</span> Ajouter des lignes</a></li>
  <li><a href="#ajouter-une-box-dinfo-ou-de-valeur" id="toc-ajouter-une-box-dinfo-ou-de-valeur" class="nav-link" data-scroll-target="#ajouter-une-box-dinfo-ou-de-valeur"> <span class="header-section-number">6.3</span> Ajouter une box d’info ou de valeur</a></li>
  <li><a href="#ajouter-une-box-de-contenu" id="toc-ajouter-une-box-de-contenu" class="nav-link" data-scroll-target="#ajouter-une-box-de-contenu"> <span class="header-section-number">6.4</span> Ajouter une box de contenu</a>
  <ul class="collapse">
  <li><a href="#avec-un-graphique" id="toc-avec-un-graphique" class="nav-link" data-scroll-target="#avec-un-graphique"> <span class="header-section-number">6.4.1</span> Avec un graphique</a></li>
  <li><a href="#avec-une-carte" id="toc-avec-une-carte" class="nav-link" data-scroll-target="#avec-une-carte"> <span class="header-section-number">6.4.2</span> Avec une carte</a></li>
  <li><a href="#avec-une-liste" id="toc-avec-une-liste" class="nav-link" data-scroll-target="#avec-une-liste"> <span class="header-section-number">6.4.3</span> Avec une liste</a></li>
  <li><a href="#ajout-de-boutons" id="toc-ajout-de-boutons" class="nav-link" data-scroll-target="#ajout-de-boutons"> <span class="header-section-number">6.4.4</span> Ajout de boutons</a></li>
  <li><a href="#utilisation-de-la-fenêtre-pliable-de-droite" id="toc-utilisation-de-la-fenêtre-pliable-de-droite" class="nav-link" data-scroll-target="#utilisation-de-la-fenêtre-pliable-de-droite"> <span class="header-section-number">6.4.5</span> Utilisation de la fenêtre pliable de droite</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/anaelDelorme/doc_outil_suivi_collecte/edit/main/add_box.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ajout de box dans une page</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>L’ajout de box dans une page se fait dans le programme R/mod_name_of_module1_ui. Dance ce programme il y a 3 parties à modifier :</p>
<ul>
<li>dans l’<strong>entête</strong> on doit ajouter les packages à importer (ou les fonctions des packages),<br>
</li>
<li>la fonction <strong>mod_name_of_module1_ui</strong> qui va gérer l’affichage dans la page : les lignes et les box que l’on ajoute,<br>
</li>
<li>la fonction <strong>mod_name_of_module1_server</strong> qui permet de faire les calculs et les traitements qui seront affichés dans les box.</li>
</ul>
<p>La distiction <em>ui</em> et <em>server</em> est classique pour toute application shiny. Voir la <a href="https://shiny.posit.co/r/getstarted/shiny-basics/lesson1/">documentation shiny</a> si besoin.</p>
<section id="accès-aux-données" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="accès-aux-données"><span class="header-section-number">6.1</span> Accès aux données</h2>
<p>Pour créer les box de suivi de la collecte, il faut avoir un accès à la donnée. Pour rappel la donnée est stockée au format parquet dans le bucket partagé.</p>
<section id="le-plus-simple-chargement-à-chaque-module" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="le-plus-simple-chargement-à-chaque-module"><span class="header-section-number">6.1.1</span> Le plus simple : chargement à chaque module</h3>
<p>Dans chaque module, charger les données avant de lancer les fonction ui et server :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom aws.s3 s3read_using</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom arrow read_parquet</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @noRd</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data_suivi <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> arrow<span class="sc">::</span>read_parquet,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">"ESEA/suivi.parquet"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">"projet-suivi-collecte-masa"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour vérifier que l’import des données fonctionne, vous pouvez modifier le fichier de module de la manière suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="fu">ns</span>(<span class="st">"data_test_load"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id){</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session){</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    ns <span class="ot">&lt;-</span> session<span class="sc">$</span>ns</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>data_test_load <span class="ot">&lt;-</span>  <span class="fu">renderText</span>({</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        data <span class="ot">&lt;-</span> data_suivi</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">nrow</span>(data)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mieux-charger-les-données-une-seule-fois" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="mieux-charger-les-données-une-seule-fois"><span class="header-section-number">6.1.2</span> Mieux : charger les données une seule fois</h3>
<p>Pour être plus propre, on peut charger les données une seule fois en utilisant la <a href="https://rtask.thinkr.fr/fr/la-communication-entre-modules-et-ses-caprices/">technique du petit r</a>.</p>
<p>Dans le fichier R/app_server.R il faut créer un r qui soit un <strong>reactiveValues</strong>, puis charger les jeux de données dans ce r, et passer ce r en paramètre des mod_XXXXX_server. Exemple :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>app_server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>({</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    r<span class="sc">$</span>data_suivi <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> arrow<span class="sc">::</span>read_parquet,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">object =</span> <span class="st">"ESEA/suivi.parquet"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">bucket =</span> <span class="st">"projet-suivi-collecte-masa"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        )  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Your application server logic</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mod_suivi_collecte_server</span>(<span class="st">"suivi_collecte_1"</span>,r)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis dans le mod_XXXXX_ui, il faut mettre à jour la fonction <strong>mod_XXXX_server</strong> pour intégrer le r. Exemple :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="fu">ns</span>(<span class="st">"data_test_load"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, r){</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session){</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    ns <span class="ot">&lt;-</span> session<span class="sc">$</span>ns</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>data_test_load <span class="ot">&lt;-</span>  <span class="fu">renderText</span>({r<span class="sc">$</span>data_suivi })</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pensez ensuite à lancer un <strong>attachment::att_amend_desc()</strong> afin d’intégrer les packages dans les dépendances.</p>
</section>
</section>
<section id="ajouter-des-lignes" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="ajouter-des-lignes"><span class="header-section-number">6.2</span> Ajouter des lignes</h2>
<p>Le principe du body de bs4Dash est de mettre des lignes et dans chaque ligne mettre des box. Pour ajouter une ligne, c’est très simple, il faut ajouter un <strong>fluidRow()</strong> dans l’ui du module (dans le <strong>tagList</strong>).</p>
</section>
<section id="ajouter-une-box-dinfo-ou-de-valeur" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="ajouter-une-box-dinfo-ou-de-valeur"><span class="header-section-number">6.3</span> Ajouter une box d’info ou de valeur</h2>
<p>Côté ui, il faut ajouter une valueBoxOupt ou une infoBoxOutput. Côté server, il faut créer un renderValueBox ou un renderValueBox.</p>
<p>Attention, en golem pour passer du server à l’ui il faut envoyer l’output avec un ns(). Par exemple si l’output est “ma_value_box” alors dans l’ui il faudra appeler renderValueBox(ns(“ma_value_box”)).</p>
<p>Dans l’exemple ci-dessous, on utilise la stratégie du petit r pour que les données soient utilisées pour tout le site. Dans la partie server, il faudra mettre le code dans un Observe pour avoir accès aux reactiveValues du petit r.</p>
<p>Exemple :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> <span class="fu">NS</span>(id)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tagList</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fluidRow</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">infoBoxOutput</span>(<span class="fu">ns</span>(<span class="st">"nb_questionnaires"</span>)),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">valueBoxOutput</span>(<span class="fu">ns</span>(<span class="st">"taux_collecte"</span>)),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">valueBoxOutput</span>(<span class="fu">ns</span>(<span class="st">"taux_reponse"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>mod_suivi_collecte_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, r){</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session){</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ns <span class="ot">&lt;-</span> session<span class="sc">$</span>ns</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      questionnaires_totaux_esea <span class="ot">&lt;-</span> r<span class="sc">$</span>data_suivi <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      questionnaires_collectes <span class="ot">&lt;-</span>  r<span class="sc">$</span>data_suivi <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ETAT_CONTROLE  <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      questionnaires_valides <span class="ot">&lt;-</span>  r<span class="sc">$</span>data_suivi <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ETAT_CONTROLE  <span class="sc">==</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>nb_questionnaires <span class="ot">&lt;-</span> <span class="fu">renderInfoBox</span>({</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">infoBox</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Nombre total de questionnaires"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">gradient =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"info"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> questionnaires_totaux_esea,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"paper-plane"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>       output<span class="sc">$</span>taux_collecte <span class="ot">&lt;-</span> <span class="fu">renderValueBox</span>({</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">valueBox</span>(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="fu">glue</span>(<span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span>(questionnaires_collectes <span class="sc">/</span> questionnaires_totaux_esea),<span class="dv">3</span>), <span class="st">' %'</span>),</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"Taux de collecte (questionnaires qui ne sont plus en état initial)"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"primary"</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"circle-check"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>taux_reponse <span class="ot">&lt;-</span> <span class="fu">renderValueBox</span>({</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">valueBox</span>(</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="fu">glue</span>(<span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span>(questionnaires_valides <span class="sc">/</span> questionnaires_totaux_esea),<span class="dv">3</span>), <span class="st">' %'</span>),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"Taux de réponse (questionnaires validés)"</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"teal"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"thumbs-up"</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajouter-une-box-de-contenu" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="ajouter-une-box-de-contenu"><span class="header-section-number">6.4</span> Ajouter une box de contenu</h2>
<p>Pour ajouter des box de contenus, on fera la même chose que pour les box de valeur / info : on ajoute une fluidRow et on y met une ou plusieurs <strong>bs4Dash::box</strong>. Parmi les paramètres de la box on pourra gérer le titre, le statut (la couleur), la taille en hauteur et en largeur…</p>
<section id="avec-un-graphique" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="avec-un-graphique"><span class="header-section-number">6.4.1</span> Avec un graphique</h3>
<p>On peut facilement ajouter des graphiques ggplot2. Mais pour un rendu plus joli sur le web nous préconisons l’utilisation de <a href="https://echarts4r.john-coene.com/">echarts4r</a>. Dans une bs4Dash::box, on ajoutera un echarts4rOutput et dans le server on créera un renderEcharts4r.</p>
<p>Voici un exemple :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># côté ui, dans le tagList :</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      bs4Dash<span class="sc">::</span><span class="fu">box</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Avancement de la collecte"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">status =</span> <span class="st">"orange"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">echarts4rOutput</span>(<span class="fu">ns</span>(<span class="st">"pie_questionnaire_par_etat"</span>))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    )    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># côté server</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>pie_questionnaire_par_etat <span class="ot">&lt;-</span> <span class="fu">renderEcharts4r</span>({</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>       dossier <span class="ot">&lt;-</span> r<span class="sc">$</span>data_suivi</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>       questionnaire_par_etat <span class="ot">&lt;-</span> dossier <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">count</span>(ETAT_CONTROLE) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">ETAT_CONTROLE =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            ETAT_CONTROLE <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Non collecté"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            ETAT_CONTROLE <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Validé"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            ETAT_CONTROLE <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"A confirmer"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            ETAT_CONTROLE <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"A compléter"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            ETAT_CONTROLE <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"A corriger"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Indéterminé"</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>       questionnaire_par_etat <span class="sc">%&gt;%</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">e_charts</span>(ETAT_CONTROLE) <span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">e_pie</span>(n, <span class="at">radius =</span> <span class="fu">c</span>(<span class="st">"40%"</span>, <span class="st">"70%"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">e_tooltip</span>(<span class="at">formatter =</span> htmlwidgets<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"function(params) {return params.name + ': ' + params.value;}"</span>))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="avec-une-carte" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="avec-une-carte"><span class="header-section-number">6.4.2</span> Avec une carte</h3>
<p>Pour les cartes, nous préconisons leaflet qui permet de faire des cartes web zoomable assez chouettes.</p>
<p>Avant tout, il faut charger les fonds de carte. Nous préconisons l’utilisation de topojson accessible en ligne :</p>
<ul>
<li><a href="https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/regions.topojson">Régions de France</a></li>
<li><a href="https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/departements.topojson">Départements de France</a></li>
</ul>
<p>Nous les ajoutons au r pour qu’ils soient accessibles dans tous les modules, en passant par le package <strong>geojsonio</strong> (à ajouter aux imports).</p>
<p>Pour que <strong>geojsonio</strong> fonctionne, il faut installer plusieurs librairies dans le serveur hébergeant le VSCode. Pour cela il faut ouvrir un nouveau terminal (un terminal de base, pas un terminal R) et lancer successivement les commandes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="op">-</span>get update</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="op">-</span>get <span class="op">-</span>y install libudunits2<span class="op">-</span>dev</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="op">-</span>get <span class="op">-</span>y install libproj<span class="op">-</span>dev</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sudo apt<span class="op">-</span>get <span class="op">-</span>y install libgdal<span class="op">-</span>dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis on peut ajouter les topojson à notre petit r, dans le fichier R/app_server.R :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>r<span class="sc">$</span>map_region <span class="ot">&lt;-</span> geojsonio<span class="sc">::</span><span class="fu">topojson_read</span>(<span class="st">"https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/regions.topojson"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>r<span class="sc">$</span>map_departements <span class="ot">&lt;-</span> geojsonio<span class="sc">::</span><span class="fu">topojson_read</span>(<span class="st">"https://raw.githubusercontent.com/neocarto/resources/master/geometries/France/departements.topojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons maintenant ajouter une box contenant un <strong>leafletOutput</strong> et créer la foncion <strong>renderLeaflet</strong> côté serveur. Voici un exemple de carte choroplèthe par région :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">### dans la partie ui</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>      bs4Dash<span class="sc">::</span><span class="fu">box</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Avancement de la collecte"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">status =</span> <span class="st">"indigo"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">leafletOutput</span>(<span class="fu">ns</span>(<span class="st">"map_taux_collecte"</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    )    </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">### dans la partie server</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>map_taux_collecte <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        suivi_par_region <span class="ot">&lt;-</span> r<span class="sc">$</span>data_suivi <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">collecte =</span> <span class="fu">ifelse</span>(ETAT_CONTROLE <span class="sc">==</span> <span class="dv">1</span> , <span class="st">"Non collecté"</span>, <span class="st">'Collecté'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(collecte, REP_CODE_REG_1) <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> collecte, <span class="at">values_from =</span> n,  <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(REP_CODE_REG_1)) <span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">total =</span> Collecté <span class="sc">+</span> <span class="st">`</span><span class="at">Non collecté</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">taux_collecte =</span> Collecté<span class="sc">/</span>total)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        data_map <span class="ot">&lt;-</span> r<span class="sc">$</span>map_regions <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">left_join</span>(suivi_par_region, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"REG"</span> <span class="ot">=</span> <span class="st">"REP_CODE_REG_1"</span>))</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="st">"RdYlGn"</span>, <span class="cn">NULL</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        leaflet<span class="sc">::</span><span class="fu">leaflet</span>(data_map) <span class="sc">%&gt;%</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">addPolygons</span>(<span class="at">stroke =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">smoothFactor =</span> <span class="fl">0.3</span>, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">pal</span>(taux_collecte),</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">label =</span> <span class="sc">~</span><span class="fu">paste0</span>(Name, <span class="st">": "</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> taux_collecte,<span class="dv">0</span>),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                              <span class="st">" % / "</span>,Collecté,<span class="st">" collectés pour "</span>, total,<span class="st">" au total."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>              <span class="fu">addLegend</span>(<span class="at">pal =</span> pal, <span class="at">values =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>taux_collecte,<span class="dv">0</span>), <span class="at">title =</span> <span class="st">"Taux de collecte"</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="st">"bottomright"</span>, <span class="at">na.label=</span> <span class="st">"?"</span>,<span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix=</span><span class="st">" %"</span>))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="avec-une-liste" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="avec-une-liste"><span class="header-section-number">6.4.3</span> Avec une liste</h3>
</section>
<section id="ajout-de-boutons" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4" class="anchored" data-anchor-id="ajout-de-boutons"><span class="header-section-number">6.4.4</span> Ajout de boutons</h3>
</section>
<section id="utilisation-de-la-fenêtre-pliable-de-droite" class="level3" data-number="6.4.5">
<h3 data-number="6.4.5" class="anchored" data-anchor-id="utilisation-de-la-fenêtre-pliable-de-droite"><span class="header-section-number">6.4.5</span> Utilisation de la fenêtre pliable de droite</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./squellete_appli.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Squelette de l’application Shiny</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./add_shinymanager.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">add_shinymanager.html</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>